{% extends "base.html" %}

{% block content %}
<style>
    :root {
        --robot-blue: #0066ff;
        --industrial-gray: #1a1c1e;
        --steel-border: #2d3136;
        --text-main: #e1e1e1;
        --text-muted: #62676b;
        --bg-deep: #050505;
    }

    body {
        background-color: var(--bg-deep) !important;
        color: var(--text-main);
        font-family: 'JetBrains Mono', 'Segoe UI', monospace;
    }

    /* PANEL SUPERIOR */
    .otto-panel {
        background: var(--industrial-gray);
        border: 1px solid var(--steel-border);
        margin: 15px;
        padding: 15px;
        border-radius: 4px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
    }

    .panel-info { display: flex; align-items: center; gap: 12px; }
    .status-indicator { width: 8px; height: 8px; background: var(--robot-blue); box-shadow: 0 0 8px var(--robot-blue); }
    .panel-title { font-weight: 700; font-size: 11px; letter-spacing: 1.5px; margin: 0; }

    /* BUSCADOR */
    .search-container { padding: 0 15px; margin-bottom: 20px; }
    .search-box { background: #000; border: 1px solid var(--steel-border); display: flex; border-radius: 50px; overflow: hidden; }
    .search-input { background: transparent; border: none; color: white; padding: 12px 15px; width: 100%; font-size: 12px; outline: none; }
    .search-btn { background: var(--robot-black); color: white; border: none; padding: 0 20px; font-weight: bold; font-size: 11px; cursor: pointer; }

    /* CATEGOR√çAS */
    .cat-btn {
        background: #0f1113; border: 1px solid #2d3136; color: #888; padding: 10px 18px;
        text-decoration: none; font-size: 11px; font-weight: 700; text-transform: uppercase;
        border-radius: 4px; display: flex; align-items: center; transition: 0.2s;
    }
    .cat-btn:hover, .cat-btn.active { border-color: var(--robot-blue); color: #fff; background: rgba(0, 102, 255, 0.1); }

    /* GRID Y CARDS */
    .market-container { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; padding: 0 15px 20px; }
    .product-card { background: var(--industrial-gray); border: 1px solid var(--steel-border); padding: 8px; position: relative; }
    .img-container { width: 100%; height: 120px; background: #000; margin-bottom: 8px; position: relative; overflow: hidden; }
    .img-container img { width: 100%; height: 100%; object-fit: cover; }
    .unit-label { position: absolute; top: 5px; left: 5px; background: rgba(0,0,0,0.8); border-left: 2px solid var(--robot-blue); color: white; font-size: 8px; padding: 2px 6px; }
    .product-title { font-size: 10px; color: var(--text-muted); text-transform: uppercase; margin-bottom: 2px; }
    .price-display { font-size: 1.2rem; font-weight: 800; color: #fff; margin-bottom: 8px; }
    .action-button { text-decoration: none; color: var(--robot-blue); border: 1px solid var(--robot-blue); text-align: center; padding: 6px; font-size: 9px; font-weight: bold; display: block; }

    /* ESTILOS DEL SISTEMA DE CARGA (SKELETON) */
    .skeleton-card { border-color: #1a1c1e !important; }
    .sk-block { 
        background: linear-gradient(90deg, #111 25%, #1a1c1e 50%, #111 75%);
        background-size: 200% 100%; animation: shimmer 1.5s infinite linear;
    
    }
    @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
</style>
<div class="otto-panel-premium">
    <div class="border-glow"></div>
    
    <div class="panel-info">
        <div class="status-indicator blink-alive"></div>
        <h2 class="panel-title">OTTO_MARKET // GLOBAL_RADAR</h2>
    </div>
    <span class="units-counter">PUBLICACIONES: {{ anuncios|length }}</span>
</div>

<style>
    .otto-panel-premium {
        position: relative;
        background: rgba(5, 5, 5, 0.9);
        padding: 15px;
        border: 1px solid rgba(0, 243, 255, 0.2);
        overflow: hidden;
        display: flex;
        justify-content: space-between;
        align-items: center;
        /* Corte futurista */
        clip-path: polygon(0 0, 95% 0, 100% 25%, 100% 100%, 5% 100%, 0 75%);
    }

    /* EL PUNTO PARPADEANTE (STATUS) */
    .status-indicator.blink-alive {
        width: 8px;
        height: 8px;
        background: #00f3ff;
        box-shadow: 0 0 10px #00f3ff;
        border-radius: 2px;
        margin-right: 10px;
        animation: pulse-life 1s infinite;
    }

    @keyframes pulse-life {
        0% { opacity: 1; transform: scale(1); }
        50% { opacity: 0.3; transform: scale(1.2); }
        100% { opacity: 1; transform: scale(1); }
    }

    /* LUZ QUE RECORRE EL PER√çMETRO */
    .border-glow {
        position: absolute;
        top: 0; left: 0;
        width: 100%; height: 100%;
        pointer-events: none;
    }

    .border-glow::before {
        content: "";
        position: absolute;
        width: 60px; height: 2px;
        background: #00f3ff;
        box-shadow: 0 0 15px #00f3ff;
        animation: track-border 4s linear infinite;
    }

    @keyframes track-border {
        0% { top: 0; left: -60px; }
        25% { top: 0; left: 100%; }
        50% { top: 100%; left: 100%; transform: rotate(90deg); }
        75% { top: 100%; left: -60px; }
        100% { top: 0; left: -60px; }
    }

    .panel-info { display: flex; align-items: center; }
    .panel-title {
        color: #00f3ff;
        font-family: 'Orbitron', sans-serif;
        font-size: 0.8rem;
        letter-spacing: 2px;
        margin: 0;
        text-shadow: 0 0 5px rgba(0, 243, 255, 0.5);
    }

    .units-counter {
        color: #999;
        font-family: 'monospace';
        font-size: 10px;
        text-transform: uppercase;
    }
</style>


<div class="search-container">
    <form action="{% url 'home' %}" method="GET">
        <div class="search-box">
            <input type="text" name="q" class="search-input" placeholder="ESCANEANDO_DATA..." value="{{ request.GET.q }}">
            <button type="submit" class="search-btn" onclick="showOttoNotification('CONEXI√ìN_ESTABLECIDA', 'success')">
    BUSCAR
</button>

        </div>
    </form>
</div>







<style>
    /* RESET DE LA BARRA DE ESC√ÅNER */
    .category-scanner {
        background: rgba(0, 5, 5, 0.9);
        border-bottom: 2px solid #0ff;
        padding: 15px 0;
        overflow: hidden;
    }
    
    /* CONTENEDOR HORIZONTAL */
    .filter-bar {
        display: flex;
        flex-direction: row; /* FUERZA HORIZONTAL */
        overflow-x: auto;    /* ACTIVA SCROLL LATERAL */
        white-space: nowrap;
        gap: 15px;
        padding: 10px 20px;
    }

    /* OCULTAR BARRA DE SCROLL MANTENIENDO FUNCI√ìN */
    .filter-bar::-webkit-scrollbar { display: none; }
    .filter-bar { -ms-overflow-style: none; scrollbar-width: none; }

    /* BOTONES CYBERPUNK */
    .cat-btn {
        display: inline-block;
        color: #0ff;
        text-decoration: none;
        padding: 8px 25px;
        border: 1px solid #0ff;
        font-family: 'Courier New', monospace;
        font-weight: bold;
        text-transform: uppercase;
        background: transparent;
        transition: 0.3s;
        box-shadow: inset 0 0 5px #0ff;
    }

    .cat-btn.active {
        background: #0ff;
        color: #000;
        box-shadow: 0 0 15px #0ff;
    }
</style>


<style>
  .scanner-main {
        width: 100%;
        background: #000;
        /* L√≠nea de base en gris sutil */
        border-bottom: 1px solid #1a1a1a; 
        padding: 15px 10px;
        box-sizing: border-box;
    }

    .grid-radar {
        display: flex;
        flex-wrap: wrap; 
        gap: 12px; /* Aumentamos el gap para que se noten las curvas */
        justify-content: center; 
    }

    .btn-cyber {
        /* Mantenemos el tama√±o para 2 por fila en m√≥vil */
        flex: 1 1 45%; 
        min-width: 140px; 
        position: relative;
        background: #0a0a0a; /* Fondo oscuro Neon.tech */
        color: #888; /* CAMBIO: Gris en lugar de Cian */
        border: 1px solid #1a1a1a; /* Borde gris acero sutil */
        border-radius: 12px; /* CAMBIO: Puntas redondeadas */
        padding: 15px 5px;
        text-align: center;
        text-decoration: none;
        font-family: 'Inter', sans-serif; /* Tipograf√≠a m√°s moderna */
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        overflow: hidden;
        transition: all 0.3s ease;
        -webkit-tap-highlight-color: transparent;
    }

    /* BARRIDO L√ÅSER L√çMPIO */
 .btn-cyber::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.05), transparent);
        animation: sweep 3s infinite;
    }

    /* ESTADO ACTIVO: Se ilumina sutilmente */
    .btn-cyber.active {
        border: 1px solid #444 !important;
        background: #111 !important;
        color: #fff !important; /* Texto blanco cuando est√° activo */
        box-shadow: 0 0 15px rgba(255, 255, 255, 0.03) !important;
    }

    /* Efecto al tocar */
    .btn-cyber:active {
        transform: scale(0.96);
        background: #161616;
    }

    @keyframes sweep {
        0% { left: -100%; }
        50% { left: 100%; }
        100% { left: 100%; }
    }
</style>




<div class="scanner-main">
    <div class="grid-radar">
        <a href="{% url 'home' %}" class="btn-cyber {% if not query %}active{% endif %}">TODO</a>
        <a href="?q=Veh√≠culos" class="btn-cyber {% if query == 'Veh√≠culos' %}active{% endif %}">VEH√çCULOS</a>
        <a href="?q=Tecnologia" class="btn-cyber {% if query == 'Tecnolog√≠a' %}active{% endif %}">TECNOLOGIA</a>
        <a href="?q=Hogar" class="btn-cyber {% if query == 'Hogar' %}active{% endif %}">HOGAR</a>
          
          <a href="?q=Servicios" class="btn-cyber {% if query == 'Servicios' %}active{% endif %}">SERVICIOS</a>

          <a href="?q=Otros" class="btn-cyber {% if query == 'Otros' %}active{% endif %}">OTROS</a>

    </div>
</div>






<div id="loading-skeleton" class="market-container">
    {% for i in "1234" %}
    <div class="product-card skeleton-card">
        <div class="sk-block" style="height: 120px; margin-bottom: 8px;"></div>
        <div class="sk-block" style="height: 10px; width: 60%; margin-bottom: 8px;"></div>
        <div class="sk-block" style="height: 20px; width: 40%; margin-bottom: 10px;"></div>
        <div class="sk-block" style="height: 30px; width: 100%;"></div>
    </div>
    {% endfor %}
</div>
 
<div id="real-content" class="market-container" style="display: none;">
    {% for anuncio in anuncios %}
    <div class="product-card">
        <div class="img-container">
            <div class="unit-label">{{ anuncio.tipo_negocio| default:"venta" }}</div>
            {% if anuncio.foto %}
                <img src="{{ anuncio.foto.url }}" alt="Data">
            {% else %}
                <div style="height: 100%; display: flex; align-items: center; justify-content: center; font-size: 8px; color: ‚Äã#EEEEEE;">NO_DATA</div>
            {% endif %}
        </div>
         <div class="product-title" style="color: #EEEEEE !important; font-size: 12px !important; font-weight: 900 !important; font-family: monospace; text-transform: uppercase; margin-top: 10px;">
    {{ anuncio.titulo|default:"-----" }} 
    <br>
    {{ anuncio.marca|default:"-----"}} 
    <br>
    {{ anuncio.modelo|default:"-----" }}
    <br>
    {{ anuncio.estado_fisico|default:"-----"}}
</div>

   <div class="price-display">${{ anuncio.precio| default:"" }}</div>
   
   
   
<div class="otto-radar-fix">
    <form method="POST" class="nano-form-left">
        {% csrf_token %}
        <div class="nano-star-cluster">
            <input type="radio" name="estrellas" value="5" id="z5-{{ anuncio.id }}"><label for="z5-{{ anuncio.id }}">‚òÖ</label>
            <input type="radio" name="estrellas" value="4" id="z4-{{ anuncio.id }}"><label for="z4-{{ anuncio.id }}">‚òÖ</label>
            <input type="radio" name="estrellas" value="3" id="z3-{{ anuncio.id }}"><label for="z3-{{ anuncio.id }}">‚òÖ</label>
            <input type="radio" name="estrellas" value="2" id="z2-{{ anuncio.id }}"><label for="z2-{{ anuncio.id }}">‚òÖ</label>
            <input type="radio" name="estrellas" value="1" id="z1-{{ anuncio.id }}"><label for="z1-{{ anuncio.id }}">‚òÖ</label>
        </div>
        
        <div class="nano-input-group">
            <input type="text" name="comentario" placeholder="Informe..." class="nano-input-field" required>
            <button type="submit" class="nano-save-icon">üíæ</button>
        </div>
    </form>
</div>

<style>
    /* 1. LIMITADOR DE ANCHO PARA NO ROMPER LAS 2 COLUMNAS */
    .otto-radar-fix {
        width: 100%;
        max-width: 100%; /* Blindado para que no empuje la caja */
        border-top: 1px solid rgba(0, 243, 255, 0.3);
        padding: 4px 2px;
        margin-top: 5px;
        box-sizing: border-box;
    }

    /* 2. ESTRELLAS: Alineaci√≥n a la izquierda y tama√±o nano */
    .nano-star-cluster {
        display: flex;
        flex-direction: row-reverse;
        justify-content: flex-end; /* ‚¨ÖÔ∏è ESTO LAS PEGA A LA IZQUIERDA */
        gap: 2px;
        margin-bottom: 4px;
    }

    .nano-star-cluster input { display: none !important; }

    .nano-star-cluster label {
        font-size: 16px; /* Tama√±o reducido para ahorrar espacio */
        color: #444;    /* Gris para visibilidad base */
        cursor: pointer;
    }

    /* Iluminaci√≥n Cian Ne√≥n */
    .nano-star-cluster input:checked ~ label,
    .nano-star-cluster label:hover ~ label {
        color: #00f3ff !important;
        text-shadow: 0 0 8px #00f3ff;
    }

    /* 3. INPUT: Tama√±o ajustado para m√≥vil */
    .nano-input-group {
        display: flex;
        align-items: center;
        width: 100%;
    }

    .nano-input-field {
        background: #000;
        border: 1px solid #ff00ff;
        color: white;
        font-size: 14px;
        height: 30px;
        width: 80%; /* No dejamos que ocupe el 100% para que no empuje */
        padding-left: 4px;
        outline: none;
    }

    .nano-save-icon {
        background: transparent;
        border: none;
        color: #00f3ff;
        font-size: 14px;
        width: 20%;
        cursor: pointer;
        filter: drop-shadow(0 0 3px #00f3ff);
    }
</style>


<a href="{% url 'detalle' anuncio.id %}" 
   class="action-button" 
   onclick="showOttoNotification('ACCEDIENDO_A_DATOS_RESERVADOS...', 'info')">
    DETALLES 
</a>



   </div> 
    {% empty %}
        <div style="grid-column: span 2; text-align: center; padding: 100px 0;">
        <i class="bi bi-cpu text-muted" style="font-size: 30px;"></i>
        <p style="font-size: 10px; color: var(--text-muted); margin-top: 10px;">QUERY_NOT_FOUND: NO SE DETECTARON SE√ëALES.</p>
    </div>
    {% endfor %}
</div>

<script>
    // PROTOCOLO DE TRANSICI√ìN: SKELETON -> RADAR REAL
    function activarRadarReal() {
        const skeleton = document.getElementById('loading-skeleton');
        const content = document.getElementById('real-content');
        
        if (skeleton && content) {
            skeleton.style.opacity = '0'; // Efecto de desvanecimiento
            setTimeout(() => {
                skeleton.style.display = 'none';
                content.style.display = 'grid';
                console.log(">> SISTEMA_OTTO: DATA_SYNC_COMPLETE");
            }, 300);
        }
    }

    // 1. Activar cuando todo cargue
    window.addEventListener('load', activarRadarReal);

    // 2. SEGURO DE VIDA: Si a los 2.5 segundos no carg√≥, forzar la vista
    // Esto evita que el usuario vea cuadros grises infinitos
    setTimeout(activarRadarReal, 2500);
</script>











<div class="otto-access-container">
    <a href="{% url 'pagina_bot' %}" class="btn-neon-tech">
        <span class="scanner-bar"></span>
        <span class="btn-text">CHAT_BOT</span>
    </a>
</div>

<style>
    .otto-access-container { margin: 25px 0; text-align: center; }

    .btn-neon-tech {
        position: relative;
        display: inline-block;
        padding: 15px 40px;
        background: #0d0d0f;       /* Negro base */
        color: #00f3ff;            /* Color Neon de referencia */
        text-decoration: none;
        font-family: 'Segoe UI', sans-serif;
        font-weight: bold;
        border: 1px solid #1a1a1c;
        border-radius: 50px;       /* CURVA SEG√öN LA P√ÅGINA */
        overflow: hidden;          /* PARA EL BARRIDO */
        transition: 0.4s;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.8);
    }

    /* EFECTO DE BARRIDO (SCANNER) */
    .scanner-bar {
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
            90deg, 
            transparent, 
            rgba(0, 243, 255, 0.2), 
            transparent
        );
        animation: scan-loop 3s infinite linear;
    }

    @keyframes scan-loop {
        0% { left: -100%; }
        100% { left: 100%; }
    }

    .btn-neon-tech:hover {
        background: #151517;
        border-color: #00f3ff;
        box-shadow: 0 0 20px rgba(0, 243, 255, 0.3);
        color: #fff;
    }

    .btn-text {
        position: relative;
        z-index: 1; /* Por encima del barrido */
        letter-spacing: 2px;
    }
</style>

{% endblock %}


        