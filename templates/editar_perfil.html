{% extends "base.html" %}
{% block content %}

<style>
    /* CUERPO ROBÓTICO - ACERO Y CARBÓN */
    .robot-chassis {
        max-width: 550px;
        margin: 50px auto;
        background: #080808;
        border: 2px solid #444;
        position: relative;
        overflow: hidden;
        box-shadow: 0 0 20px rgba(0,0,0,0.5);
    }

    /* EFECTO ESCÁNER DE FONDO (PISPÍLEO) */
    .robot-chassis::before {
        content: "";
        position: absolute;
        top: 0; left: 0; width: 100%; height: 2px;
        background: rgba(238, 238, 238, 0.1);
        animation: scanline 4s linear infinite;
        z-index: 1;
        pointer-events: none;
    }

    @keyframes scanline {
        0% { top: 0; }
        100% { top: 100%; }
    }

    /* NÚCLEO DE IDENTIDAD (TU FOTO) */
    .profile-core {
        text-align: center;
        padding: 30px;
        background: linear-gradient(180deg, #111 0%, #080808 100%);
        border-bottom: 1px solid #333;
    }

    .avatar-frame {
        width: 120px;
        height: 120px;
        margin: 0 auto;
        border: 4px solid #444;
        border-radius: 5px; 
        padding: 5px;
        background: #000;
        position: relative;
    }

    .avatar-frame img {
        width: 100%; height: 100%;
        object-fit: cover;
        filter: grayscale(0.5);
    }

    .user-tag {
        margin-top: 15px;
        font-family: 'Courier New', monospace;
        color: #EEEEEE !important;
        font-weight: 900;
        letter-spacing: 3px;
        font-size: 20px;
        text-transform: uppercase;
    }

    /* SECCIÓN DE ERRORES (EL ESCÁNER ROJO) */
    .error-log {
        background: rgba(255, 0, 85, 0.1);
        border: 1px solid #ff0055;
        color: #ff0055;
        padding: 15px;
        margin: 20px;
        font-family: monospace;
        font-size: 12px;
    }

    /* INPUTS INDUSTRIALES */
    .terminal-field {
        padding: 25px;
        background: #0a0a0a;
    }

    .field-group { margin-bottom: 20px; }

    .field-group label {
        color: #777;
        font-size: 10px;
        font-family: monospace;
        display: block;
        margin-bottom: 5px;
    }

    .terminal-field input, .terminal-field textarea, .terminal-field select {
        width: 100% !important;
        background: #000 !important;
        border: 1px solid #333 !important;
        color: #EEEEEE !important;
        padding: 10px !important;
        font-family: monospace !important;
        font-size: 15px !important;
        border-radius: 0 !important;
    }

    .terminal-field input:focus {
        border: 1px solid #EEEEEE !important;
        outline: none;
    }

    /* BOTÓN ROBÓTICO */
    .btn-robot {
        width: 100%;
        background: #222;
        color: #EEEEEE;
        border: 1px solid #444;
        padding: 15px;
        font-weight: bold;
        font-family: monospace;
        cursor: pointer;
        transition: 0.2s;
        text-transform: uppercase;
    }

    .btn-robot:hover {
        background: #EEEEEE;
        color: #000;
        animation: glitch 0.2s infinite;
    }

    @keyframes glitch {
        0% { opacity: 1; transform: skew(0deg); }
        50% { opacity: 0.8; transform: skew(2deg); }
        100% { opacity: 1; transform: skew(-2deg); }
    }
</style>

<div class="container">
    <div class="robot-chassis">
        
        <div class="profile-core">
            <div class="avatar-frame">
                {% if user.perfil.foto_perfil %}
                    <img src="{{ user.perfil.foto_perfil.url }}" alt="AVATAR">
                {% else %}
                    <div style="width:100%; height:100%; background:#222; display:flex; align-items:center; justify-content:center; color:#555;">NO_IMG</div>
                {% endif %}
            </div>
            <div class="user-tag">
            {% if user.perfil.nombre %}
                {{ user.perfil.nombre }}
               {% else %}
                {{ user.username }}
             {% endif %}
           </div>



        {# DETECTOR DE ERRORES CRÍTICOS #}
        {% if form.errors %}
        <div class="error-log">
            <strong>[ FALLO_EN_VALIDACIÓN ]</strong>
            <ul style="margin: 10px 0 0 0; padding-left: 15px;">
                {% for field, errors in form.errors.items %}
                    <li>{{ field|upper }}: {{ errors|striptags }}</li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        <div class="terminal-field">
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
                
                {% for field in form %}
                <div class="field-group">
                    <label>> {{ field.label|upper }}</label>
                    {{ field }}
                    {% if field.help_text %}
                        <small style="color: #444; font-size: 9px;">{{ field.help_text }}</small>
                    {% endif %}
                </div>
                {% endfor %}

                <button type="submit" class="btn-robot">
                   GUARDAR_PERFIL [✓]
                </button>
            </form>
        </div>

        <div style="background: #000; padding: 10px; border-top: 1px solid #222; text-align: right;">
            <span style="color: #333; font-size: 9px; font-family: monospace;">SYSTEM_VER: 2.0.26 | STATUS: STABLE</span>
        </div>
    </div>
</div>

{% endblock %}
