{% extends "base.html" %}
{% block content %}
<div class="container py-4">
    <div class="row mb-4 animate-flicker">
        <div class="col-12">
            <h2 class="cyber-title text-glitch" data-text="DASHBOARD_SISTEMA: {{ user.username|upper }}">> DASHBOARD_SISTEMA: {{ user.username|upper }}</h2>
            <div class="scanner-bar"></div>
            <small class="text-neon-cyan" style="letter-spacing: 4px;">ID_RED: {{ user.email|default:"ANONYMOUS_OPS" }} // STATUS: ONLINE</small>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-md-3 mb-3">
            <div class="cyber-card-v2 blue-flow">
                <div class="card-inner">
                    <small class="label-neon">UNIDADES_ACTIVAS</small>
                    <h2 class="value-neon">{{ stats.unidades }}</h2>
                    <small class="sub-label">TOTAL_REGISTROS</small>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="cyber-card-v2 green-flow">
                <div class="card-inner">
                    <small class="label-neon">INGRESOS_TOTALES</small>
                    <h2 class="value-neon">${{ stats.ingresos|default:"0" }}</h2>
                    <small class="trend-up">STABLE_REVENUE</small>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="cyber-card-v2 yellow-flow">
                <div class="card-inner">
                    <small class="label-neon">VISTAS_TOTALES</small>
                    <h2 class="value-neon">{{ stats.vistas_totales }}</h2>
                    <small class="trend-warning">SCAN_DATA_OK</small>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="cyber-card-v2 red-flow">
                <div class="card-inner">
                    <small class="label-neon">UNIDADES_VENDIDAS</small>
                    <h2 class="value-neon">{{ stats.vendidos }}</h2>
                    <small class="sub-label">CONVERTED_DEALS</small>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-8 mb-4">
            <div class="cyber-card-v2 blue-flow main-chart-box">
                <div class="card-inner">
                    <h6 class="label-neon mb-4">> RENDIMIENTO_SEMANAL (7D_SCAN)</h6>
                    <div style="height: 300px;"><canvas id="graficoVentas"></canvas></div>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-4">
            <div class="cyber-card-v2 purple-flow activity-box">
                <div class="card-inner">
                    <h6 class="label-neon mb-3">> LOG_DE_ACTIVIDAD_RECIENTE</h6>
                    <ul class="activity-list">
                        {% for pub in stats.recientes %}
                        <li class="log-item">
                            <span class="tag-cyber {% if pub.vendido %}red{% else %}green{% endif %}">
                                {% if pub.vendido %}VENDIDO{% else %}ACTIVO{% endif %}
                            </span> 
                            <span class="text-white">{{ pub.titulo|upper|truncatechars:15 }}</span>
                        </li>
                        {% empty %}
                        <li class="log-item"><span class="tag-cyber yellow">EMPTY</span> SIN ACTIVIDAD</li>
                        {% endfor %}
                    </ul>
                    <div class="sys-status">
                        <span class="blink-dot"></span> STATUS: {{ user.is_active|yesno:"ESTABLE,ERROR" }}
                    </div>
                </div>
            </div>
        </div>
    </div>
{% if user.is_superuser %}
    <div class="mgmt-section mt-5">
        <h3 class="cyber-title-sm text-neon-cyan">[‚öôÔ∏è] GESTI√ìN DE N√öCLEO</h3>
        <div class="row">
            <div class="col-md-6">
                <a href="{% url 'backup_sistema' %}" class="btn-cyber-neon w-100 mb-3 text-center">
                    DESCARGAR_BACKUP [üíæ]
                </a>
            </div>
            <div class="col-md-6">
                <form action="{% url 'restaurar_backup' %}" method="post" enctype="multipart/form-data" class="cyber-form">
                    {% csrf_token %}
                    <div class="input-group">
                        <input type="file" name="backup_file" class="cyber-input">
                        <button type="submit" class="btn-cyber-neon-alt">REINYECTAR_DATOS [‚ö°]</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endif %}
<style>
    /* VARIABLES DE DIOS */
    :root {
        --d-bg: #050505;
        --d-card: #0a0a0c;
        --n-blue: #00f3ff;
        --n-green: #39ff14;
        --n-yellow: #fff01f;
        --n-red: #ff0055;
        --n-purple: #bc13fe;
    }

    body { 
        background-color: var(--d-bg) !important; 
        color: #e0e0e0; 
        font-family: 'Orbitron', sans-serif; 
        overflow-x: hidden;
    }

    /* CARD V2 - NEON FLOW EFFECT */
    .cyber-card-v2 {
        position: relative;
        padding: 1px; /* Espacio para el borde animado */
        background: rgba(255, 255, 255, 0.05);
        clip-path: polygon(10% 0, 100% 0, 100% 80%, 90% 100%, 0 100%, 0 20%);
        overflow: hidden;
    }

    .card-inner {
        background: var(--d-card);
        padding: 20px;
        clip-path: polygon(10% 0, 100% 0, 100% 80%, 90% 100%, 0 100%, 0 20%);
        height: 100%;
    }

    /* BORDER ANIMATION FLOW */
    .cyber-card-v2::before {
        content: '';
        position: absolute;
        top: -50%; left: -50%;
        width: 200%; height: 200%;
        background: conic-gradient(transparent, transparent, transparent, var(--n-blue));
        animation: rotate-neon 4s linear infinite;
    }

    .blue-flow::before { background: conic-gradient(transparent, transparent, transparent, var(--n-blue)); }
    .green-flow::before { background: conic-gradient(transparent, transparent, transparent, var(--n-green)); }
    .yellow-flow::before { background: conic-gradient(transparent, transparent, transparent, var(--n-yellow)); }
    .red-flow::before { background: conic-gradient(transparent, transparent, transparent, var(--n-red)); }
    .purple-flow::before { background: conic-gradient(transparent, transparent, transparent, var(--n-purple)); }

    @keyframes rotate-neon {
        100% { transform: rotate(360deg); }
    }

    /* TITULOS Y TEXTOS */
    .cyber-title { font-weight: 900; color: var(--n-blue); text-shadow: 0 0 15px var(--n-blue); margin-bottom: 0; }
    .label-neon { font-size: 10px; color: #aaa; text-transform: uppercase; letter-spacing: 2px; }
    .value-neon { font-size: 2.2rem; color: #fff; text-shadow: 0 0 10px rgba(255,255,255,0.2); margin: 10px 0; }

    /* SCANNER BAR */
    .scanner-bar {
        height: 2px;
        background: var(--n-blue);
        width: 100%;
        margin: 10px 0;
        box-shadow: 0 0 15px var(--n-blue);
        animation: scan-move 3s ease-in-out infinite;
    }

    @keyframes scan-move {
        0%, 100% { transform: scaleX(0.1); opacity: 0.2; }
        50% { transform: scaleX(1); opacity: 1; }
    }

    /* BUTTONS PREMIUM */
    .btn-cyber-neon {
        display: inline-block;
        padding: 10px 20px;
        border: 1px solid var(--n-blue);
        color: var(--n-blue);
        text-decoration: none;
        background: rgba(0, 243, 255, 0.05);
        transition: 0.3s;
        text-transform: uppercase;
        font-weight: bold;
        clip-path: polygon(0 0, 90% 0, 100% 30%, 100% 100%, 10% 100%, 0 70%);
    }

    .btn-cyber-neon:hover {
        background: var(--n-blue);
        color: #000;
        box-shadow: 0 0 20px var(--n-blue);
    }

    .log-item {
        list-style: none;
        padding: 8px 0;
        border-bottom: 1px solid #1a1a1a;
        font-size: 12px;
    }

    .tag-cyber {
        padding: 2px 8px;
        font-size: 10px;
        border-radius: 0px;
        margin-right: 10px;
        border: 1px solid;
    }
    .tag-cyber.green { color: var(--n-green); border-color: var(--n-green); box-shadow: 0 0 5px var(--n-green); }
    .tag-cyber.red { color: var(--n-red); border-color: var(--n-red); box-shadow: 0 0 5px var(--n-red); }

    .blink-dot {
        height: 8px; width: 8px; background: var(--n-green); border-radius: 50%; display: inline-block;
        animation: blink 1s infinite;
    }

    @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.2; } }

    /* INPUTS */
    .cyber-input {
        background: #000; border: 1px solid #333; color: var(--n-blue); padding: 10px; font-size: 12px;
    }
</style>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById('graficoVentas').getContext('2d');
    const gradient = ctx.createLinearGradient(0, 0, 0, 400);
    gradient.addColorStop(0, 'rgba(0, 243, 255, 0.4)');
    gradient.addColorStop(1, 'rgba(0, 243, 255, 0)');

    new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['LUN', 'MAR', 'MIE', 'JUE', 'VIE', 'SAB', 'DOM'],
            datasets: [{
                label: 'DATA_STREAM',
                data: [65, 59, 80, 81, 56, 55, {{ stats.vistas_totales|default:40 }}],
                borderColor: '#00f3ff',
                backgroundColor: gradient,
                fill: true,
                borderWidth: 3,
                pointBackgroundColor: '#fff',
                pointBorderColor: '#00f3ff',
                pointHoverRadius: 7,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
                y: { grid: { color: '#1a1a1a' }, ticks: { color: '#00f3ff' } },
                x: { grid: { color: '#1a1a1a' }, ticks: { color: '#555' } }
            }
        }
    });
</script>

<div class="otto-static-btn" onclick="window.history.back()">
    <div class="particles-box">
        <span class="p"></span><span class="p"></span><span class="p"></span><span class="p"></span><span class="p"></span>
    </div>
    <div class="btn-content">
        <span class="scan-line-btn"></span>
        <span class="btn-arrow">‚ü∏</span>
        <span class="btn-text">VOLVER</span>
    </div>
</div>

<style>
    /* CONTENEDOR DEL BOT√ìN */
    .otto-static-btn {
        position: relative; /* YA NO ES FIXED */
        width: 160px;
        height: 48px;
        background: #000;
        border: 2px solid #00f2ff;
        border-radius: 4px;
        cursor: pointer;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: 0.3s all;
        margin: 10px 0; /* Espacio para que no pegue con lo dem√°s */
    }

    .btn-content {
        display: flex;
        align-items: center;
        gap: 10px;
        color: #00f2ff;
        font-family: 'Courier New', monospace;
        font-weight: bold;
        z-index: 5;
    }

    /* EFECTO ESC√ÅNER */
    .scan-line-btn {
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(0, 242, 255, 0.4), transparent);
        animation: scan-loop 2.5s infinite linear;
    }

    @keyframes scan-loop {
        0% { left: -100%; }
        100% { left: 100%; }
    }

    /* PART√çCULAS */
    .particles-box .p {
        position: absolute;
        width: 2px;
        height: 2px;
        background: #00f2ff;
        border-radius: 50%;
        opacity: 0;
        animation: float-up 2s infinite linear;
    }

    .particles-box .p:nth-child(1) { left: 20%; animation-delay: 0s; }
    .particles-box .p:nth-child(2) { left: 40%; animation-delay: 0.5s; }
    .particles-box .p:nth-child(3) { left: 60%; animation-delay: 1s; }
    .particles-box .p:nth-child(4) { left: 80%; animation-delay: 1.5s; }
    .particles-box .p:nth-child(5) { left: 50%; animation-delay: 0.7s; }

    @keyframes float-up {
        0% { transform: translateY(25px); opacity: 0; }
        50% { opacity: 1; }
        100% { transform: translateY(-35px); opacity: 0; }
    }

    /* EFECTO AL TOCAR */
    .otto-static-btn:active {
        transform: scale(0.95);
        box-shadow: 0 0 20px rgba(0, 242, 255, 0.5);
    }
    
    .otto-static-btn:hover {
        background: rgba(0, 242, 255, 0.1);
    }
</style>



<div style="margin-bottom: 150px; display: block; width: 100%; height: 1px;"></div>

<style>
    /* Forzamos a que el √∫ltimo elemento tenga aire abajo */
    main, section, .container {
        padding-bottom: 100px !important;
    }
</style>



{% endblock %}
